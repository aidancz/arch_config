#!/bin/sh

dirs="$XDG_CONFIG_HOME/bookmarks/dirs"
files="$XDG_CONFIG_HOME/bookmarks/files"

# output locations
mkdir -p $XDG_CONFIG_HOME/bookmarks_output
sh="$XDG_CONFIG_HOME/bookmarks_output/sh"
lf="$XDG_CONFIG_HOME/bookmarks_output/lf"

# prepare files
printf "alias \\\\\n" > "$sh"
printf "" > "$lf"

# format dirs, send
eval "echo \"$(cat "$dirs")\"" | \
awk "!/^\s*#/ && !/^\s*\$/ {gsub(\"\\\s*#.*$\",\"\");

	printf(\"%s=\42cd %s\42 \\\\\n\",\$1,\$2)          >> \"$sh\" ;
	printf(\"cmd %s cd \42%s\42\n\",\$1,\$2)           >> \"$lf\" ;

}"

# format files, send
eval "echo \"$(cat "$files")\"" | \
awk "!/^\s*#/ && !/^\s*\$/ {gsub(\"\\\s*#.*$\",\"\");

	printf(\"%s=\42\$EDITOR %s\42 \\\\\n\",\$1,\$2)    >> \"$sh\" ;
	printf(\"cmd %s \$\$EDITOR \42%s\42\n\",\$1,\$2)   >> \"$lf\" ;

}"
